# Online ordering system
> Minimal API for online ordering in Go

## Install
1. Start MongoDB database.
```
docker pull mongo
docker run --name mongodb -d -p 27017:27017 mongo
```
2. Start HTTP server.
```
git clone https://github.com/codestates/WBABEProject-22.git oos
cd oos
go mod init
go mod tidy
swag init
go run main.go
```
3. Start web browser and go to `http://localhost:8080/swagger/index.html`.
![](login.gif)
4. Login as a customer or provider and try endpoints.

## Tech stack
- Programming language: [Go](https://go.dev/)
- Web framework: [Gin](https://github.com/gin-gonic/gin)
- Database: [MongoDB](https://www.mongodb.com/) ([MongoDB Go Driver](https://www.mongodb.com/docs/drivers/go/current/))
- Documentation: [Swagger](https://swagger.io/) ([swag](https://github.com/swaggo/swag))
- Configuration: [TOML](https://toml.io/en/) ([go-toml](https://github.com/pelletier/go-toml/tree/v2))
- Logging: [Zap](https://github.com/uber-go/zap)

## Project layout
- `config`: TOML configuration
- `logger`: Zap log generator
- `db`: MongoDB database and collections
- `dto`: data transfer objects for requests and responses
- `model`: data entities
- `controller`: request handlers
- `service`: business logic that interacts with DB
- `router`: HTTP server that connects HTTP method, URL path, and request handler
- `middleware`: custom middleware (e.g. CORS, authentication, authorization, etc)
- `docs`: OAS2 documentation generated by swaggo
- `logs`: Log files generated by Zap

## Features
- Customer: 주문자
  - Query available products and my orders
  - Submit orders to providers
  - Give feedbacks on products and orders by writing reviews
- Provider: 피주문자
  - Query all products and orders
  - Create products
  - Change order status

### Customer
| Category | HTTP Method | URL Path                     | Description              |
|----------|-------------|------------------------------|--------------------------|
| Product  | `GET`       | `/products`                  | 메뉴 전체 조회           |
| Product  | `GET`       | `/products/{code}`           | 메뉴 하나 조회           |
| Order    | `GET`       | `/{username}/orders/active`  | 현재 주문 내역 전체 조회 |
| Order    | `GET`       | `/{username}/orders/history` | 과거 주문 내역 전체 조회 |
| Order    | `GET`       | `/orders/{id}`               | 주문 조회                |
| Order    | `POST`      | `/orders`                    | 주문                     |
| Order    | `PUT`       | `/orders/{id}/cart`          | 메뉴 추가 및 변경        |
| Order    | `DELETE`    | `/orders/{id}/cart`          | 메뉴 취소                |
| Order    | `GET`       | `/orders/{id}/status`        | 주문 상태 조회           |
| Review   | `GET`       | `/reviews/orders/{id}`       | 평점 및 리뷰 조회        |
| Review   | `POST`      | `/review/products/{code}`    | 평점 및 리뷰 작성        |

### Provider
| Category | HTTP Method | URL Path              | Description         |
|----------|-------------|-----------------------|---------------------|
| Product  | `POST`      | `/products`           | 신규 메뉴 등록      |
| Product  | `PUT`       | `/products/{code}`    | 기존 메뉴 수정      |
| Product  | `DELETE`    | `/products/{code}`    | 기존 메뉴 삭제      |
| Order    | `GET`       | `/orders`             | 주문 내역 전체 조회 |
| Order    | `PUT`       | `/orders/{id}/status` | 주문 상태 변경      |
| Review   | `GET`       | `/reviews/orders`     | 리뷰 모두 조회      |

## References
- Repo
  - [User management 1](https://github.com/Mr-Malomz/gin-mongo-api)
  - [User management 2](https://github.com/DevProblems/go-gin-mongo)
  - [WTF Dial](https://github.com/benbjohnson/wtf)
  - [Artifact](https://github.com/Shipu/artifact)
  - [Awesome Go](https://github.com/avelino/awesome-go)
  - [Awesome Gin](https://github.com/FlowerWrong/awesome-gin)
- Article
  - [Bookmarker](https://dev.to/wchr/create-api-with-gin-in-golang-part-1-i7d)
  - [Bookstore](https://santoshk.dev/posts/2022/building-a-bookstore-api-in-golang-with-gin/)
  - [Microservice with Go](https://blog.logrocket.com/building-microservices-go-gin/)
  - [MVC with Go](https://www.calhoun.io/using-mvc-to-structure-go-web-applications/)
- Tutorial
  - [API with Go and Gin](https://go.dev/doc/tutorial/web-service-gin)

## Feedback
- https://github.com/codestates/WBABEProject-22/pull/1/files
- <details>
  <summary>Review</summary>
  <br>
  평가 점수: A  

  - 문제 정의: 기대치 초과  

  - 메뉴 등록: 기대치 초과

  - 메뉴 출력: 기대치 **충족**

  - 메뉴 주문: 기대치 초과

  - 주문 내역: 기대치 초과

  - 주문 상태: 기대치 초과

  - 평점 리뷰: 기대치 **충족**

  - 로그 출력: 기대치 초과

  - 설정 파일: 기대치 **충족**

  - 문서화: 기대치 초과

  전반적으로 잘 동작하는 시스템으로 생각됩니다. 또한 여러 UseCase를 고려하여 상황에 필요한 API들을 잘 설계해주셨습니다. 특별히 나름의 개발 스타일을 가지고 계시며, 구현해주신 코드가 개발자에 국한되는 스타일이라고 생각되어 다름의 차이로 느껴지는 부분들이 있었습니다. 큰 리스크 요인은 아니었습니다. 전반적으로 잘 동작하고, 견고한 프로그램을 만들어주셨습니다. 이하는 제가 느낀 부분에 대한 느낌을 정리해보았습니다:


  1. user에 대한 구분을 코드에 적용시켜주신다면, 주문자와 피주문자에게 각각 호출할 수 있는 API 별 권한을 줄 수 있을 것이라 판단됩니다. controller 에서 request에 대한 user validation check 기능을 추가해보시는 것을 어떠실까요?

  2. 두번째 부분은 개인마다 다른 스타일의 차이로 여겨질 수 있는 부분이라고도 생각됩니다. server->client로 데이터를 전송할 때는 필요한 정보들만 정제하는 전처리 작업을 한번 거친 뒤 response를 내려주는 방법을 추천드립니다. 메뉴 출력 시 고객이 필요로 하는 정보만 출력해주는 방향으로 구현해 보시는 것을 어떠실까요? server와 client 측면을 모두 보았을때 보다 탄탄한 시스템이 될 것 같습니다.

  3. 시스템의 Use case를 정말 잘 정의해주신 것 같습니다. 주문 내역 조회 시 현재 주문 진행중인 상태와 그동안의 주문 history를 볼 수 있는 상태를 모두 고려해주신 부분은 정말 인상 깊었습니다.

  4. 주문 정보를 unique한 ID 값으로 관리하는 방법도 잘 사용해주셨습니다. 

  5. 주문 상태를 관리하는 데에 있어서 주문 상태를 key:value 방식으로 적절하게 잘 구현해주셨습니다. 보다 깔끔하고 유지보수하기 간편한 코딩 스타일로 보여집니다.

  6. godoc을 활용하여 주석 관리를 잘 해주셔서, 코드를 이해하는데 어렵지 않았습니다. 

  7. api의 endpoint 관리를 탁월하게 잘 해주셨습니다. 예를들어, /v01/ 과 같이 배포 시점에 따라 버전을 관리해주시는 코드는 매우 잘 작성해주셨습니다.

  8. 예외 상황에 대한 response 내용을 보다 구체적으로 명시해주시는 방법을 요청드리고 싶습니다. 다양한 케이스가 있을 것입니다. 예를 들어, 주문이 없는 상태에서 주문 상태 조회를 하는 경우, http 기본 응답 메세지를 내려주고 있으나, "진행중인 주문이 없습니다" 와 같은 메세지를 반환해준다면, 보다 견고한 코드를 만들 수 있을 것으로 보입니다.


  전반적으로 잘 짜여진 프로그램이라 생각됩니다. 실제 서비스 관점에서 코드가 동작할 수 있는 탄탄한 코드입니다. 서버의 MVC 모델을 정확하게 이해하고 구현하신 느낌이 들어 테스트하는 입장에서 보기 어렵지 않았습니다. 정말 고생 많으셨습니다.

  감사합니다.
  </details>

## Changelog
- 2023-01-18
  - New feature: Sort products by the following variables:
    - Date of creation
    - Average rating
    - Number of likes
    - Number of follow-up orders
  - New feature: Authorization using [JWT](https://jwt.io/)
    - Middleware for validation of JWT format
    - Middleware for role-based access control using the `scope` field in JWT payload
  - New feature: Mock authentication that generates a simple JWT access token
    - Customer
    - Provider
  - Refactoring: model and dto
    - Input validation (through struct tags) isolated to dto
    - Separate `*View` structs to select fields to return to users

## TODO
- [ ] [Error handling](https://climbtheladder.com/10-golang-error-handling-best-practices/)
  - [ ] `db`: remove panics
  - [ ] `controller`: elaborate error messages for various situations
- [ ] Sample data
  - [ ] [MongoDB Go Driver InsertMany](https://www.mongodb.com/docs/drivers/go/current/usage-examples/insertMany/)
  - [ ] [OAS3 examples](https://swagger.io/docs/specification/adding-examples/)
  - [ ] OAS2 example
- [ ] README: feature table like [this](https://realpython.com/flask-connexion-rest-api/#planning-part-one)
- [ ] MongoDB authentication
  - [ ] Generate random key, and store it in an environment variable
  - [ ] Encrypt username and password using the random key, and store them in the TOML config file
  - [ ] Decrypt the user credentials with the random key during runtime
- [ ] Test
  - [ ] [testing](https://pkg.go.dev/testing)
  - [ ] [testify](https://github.com/stretchr/testify)
- [ ] Validation: 
  - [x] [gin](https://gin-gonic.com/docs/examples/binding-and-validation/)
  - [ ] [gookit/validate](https://github.com/gookit/validate)
  - [ ] [phonenumbers](https://github.com/nyaruka/phonenumbers)
  - [ ] [address](https://github.com/Boostport/address)
- [ ] Documentation: [Reddit](https://www.reddit.com/r/golang/comments/udfujj/any_good_openapi_3x_spec_generator_for_a_go_rest/)
  - [ ] Code first
    - [x] [OAS2.0: swag](https://github.com/swaggo/swag)
    - [ ] [OAS3.0: swaggest/rest](https://github.com/swaggest/rest)
  - [ ] Design first
    - [ ] [goa](https://goa.design/)
    - [ ] [oapi-codegen](https://github.com/deepmap/oapi-codegen)
    - [ ] [ogen](https://github.com/ogen-go/ogen)
    - [ ] [openapi-generator](https://openapi-generator.tech/)
    - [ ] [swagger-codegen](https://swagger.io/docs/open-source-tools/swagger-codegen/)
- [ ] Configuration: [viper](https://github.com/spf13/viper)
- [ ] Style guide: [Google](https://google.github.io/styleguide/go/)
- [ ] Security
  - [ ] Authentication
  - [x] Authorization
- [ ] Deploy
  - [ ] DB
  - [ ] Server
  - [ ] Swagger
- [ ] DB
  - [ ] Local: [Docker image](https://hub.docker.com/_/mongo)
  - [ ] Cloud: [MongoDB Atlas](https://www.mongodb.com/atlas)
- [ ] Build
  - [ ] Makefile
  - [ ] Dockerfile
- [ ] API
  - [ ] GraphQL
  - [ ] gRPC
